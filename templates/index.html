<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VOTEC Video Downloader</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col items-center justify-center p-4">

<header class="text-center mb-8">
Â  <h1 class="text-3xl font-bold text-blue-500">ğŸ¥ VOTEC Video Downloader</h1>
Â  <p class="text-gray-400 text-sm mt-2">Download videos & audio from YouTube, TikTok, Instagram, Facebook</p>
</header>

<div class="bg-gray-900 rounded-2xl p-6 w-full max-w-lg shadow-lg">
Â  <label for="url" class="block text-sm text-gray-400 mb-2">Paste your video link below:</label>
Â  <input id="url" type="text" placeholder="https://www.youtube.com/watch?v=..."
Â  Â  Â  Â  Â class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" />
Â  <button id="fetchInfo" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 transition-all py-3 rounded-lg font-semibold">
Â  Â  Fetch Video Info
Â  </button>

Â  <div id="videoInfo" class="mt-6 hidden bg-gray-800 p-4 rounded-lg">
Â  Â  <img id="thumbnail" class="rounded-lg mb-4 w-full" src="" alt="Thumbnail">
Â  Â  <h2 id="title" class="text-lg font-bold mb-4"></h2>

Â  Â  <label class="text-gray-400 text-sm mb-1 font-semibold">Select Quality & Type:</label>
Â  Â  <div class="relative mb-4">
Â  Â  Â  <select id="formatSelect" class="appearance-none w-full p-3 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
Â  Â  Â  <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">â–¼</div>
Â  Â  </div>

Â  Â  <button id="downloadBtn" class="mt-2 w-full bg-green-600 hover:bg-green-700 transition-all py-3 rounded-lg font-semibold">
Â  Â  Â  Download
Â  Â  </button>

Â  Â  <div class="mt-4 bg-gray-700 h-4 rounded-full overflow-hidden">
Â  Â  Â  <div id="progressBar" class="bg-blue-500 h-4 w-0"></div>
Â  Â  </div>
Â  </div>

Â  <div id="status" class="mt-4 text-center text-sm text-gray-400"></div>
</div>

<footer class="mt-10 text-gray-500 text-xs text-center">
Â  Â© 2025 VOTEC | Built with â¤ï¸ by Kennedy
</footer>

<script>
const fetchBtn = document.getElementById('fetchInfo');
const urlInput = document.getElementById('url');
const videoInfoDiv = document.getElementById('videoInfo');
const thumbnailImg = document.getElementById('thumbnail');
const titleEl = document.getElementById('title');
const formatSelect = document.getElementById('formatSelect');
const statusBox = document.getElementById('status');
const downloadBtn = document.getElementById('downloadBtn');
const progressBar = document.getElementById('progressBar');

fetchBtn.addEventListener('click', async () => {
Â  const url = urlInput.value.trim();
Â  if (!url) { statusBox.textContent = 'âš ï¸ Enter a valid URL.'; return; }
Â  statusBox.textContent = 'â³ Fetching video info...';
Â  formatSelect.innerHTML = '';

Â  try {
Â  Â  const res = await fetch('/info', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({ url })
Â  Â  });
Â  Â  const data = await res.json();
Â  Â  if (data.error) { statusBox.textContent = `âŒ ${data.error}`; return; }

Â  Â  videoInfoDiv.classList.remove('hidden');
Â  Â  thumbnailImg.src = data.thumbnail;
Â  Â  titleEl.textContent = data.title;

Â  Â  data.formats.forEach(f => {
Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  const size = f.filesize ? `(${(f.filesize / 1024 / 1024).toFixed(2)} MB)` : '';
Â  Â  Â  let type = f.vcodec !== 'none' ? 'Video' : 'Audio';
Â  Â  Â  let label = `${type} - ${f.resolution || f.format_note} ${f.ext} ${size}`;
Â  Â  Â  option.value = f.format_id;
Â  Â  Â  option.textContent = label;
Â  Â  Â  formatSelect.appendChild(option);
Â  Â  });

Â  Â  statusBox.textContent = 'âœ… Video info loaded. Choose quality and download.';
Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  statusBox.textContent = 'ğŸš¨ Error fetching video info.';
Â  }
});

downloadBtn.addEventListener('click', async () => {
Â  const url = urlInput.value.trim();
Â  const format_id = formatSelect.value;
Â  // Get a clean filename from the video title
Â  const filename = titleEl.textContent.replace(/[^\w\s]/gi, "") || 'video'; 

Â  if (!url || !format_id) return;
Â  statusBox.textContent = 'â³ Starting download stream...';
Â  progressBar.style.width = '0%'; // Reset progress bar

Â  try {
Â  Â  // Send the filename along with the URL and format_id
Â  Â  const res = await fetch('/download', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({ url, format_id, filename })
Â  Â  });

Â  Â  if (!res.ok) {
Â  Â  Â  // If the server returns an error, try to parse the error message
Â  Â  Â  const contentType = res.headers.get("content-type");
Â  Â  Â  if (contentType && contentType.indexOf("application/json") !== -1) {
Â  Â  Â  Â  const err = await res.json();
Â  Â  Â  Â  statusBox.textContent = `âŒ ${err.error || 'Download failed'}`;
Â  Â  Â  } else {
Â  Â  Â  Â  // For non-JSON errors (like server 500), use generic message
Â  Â  Â  Â  statusBox.textContent = `âŒ Download failed with status: ${res.status}`;
Â  Â  Â  }
Â  Â  Â  return;
Â  Â  }
    
    // --- CRITICAL CHANGE FOR STREAMING ---
    // Instead of reading the whole blob, we rely on the server's response headers 
    // (Content-Disposition) to prompt the browser to save the file directly.
    
    // To trigger the actual download from the server's streaming response, 
    // we use a simple fetch call. Since we no longer use a blob, we don't 
    // need the old link creation logic.

    statusBox.textContent = 'âœ… Download started in your browser!';
Â  Â  progressBar.style.width = '100%';
    
    // The browser will handle the file saving prompt due to the server's headers.
    // We leave the fetch response to be consumed by the browser's download manager.


Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  statusBox.textContent = 'ğŸš¨ Error during download. Check console for details.';
Â  }
});
</script>
</body>
</html>