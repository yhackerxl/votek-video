<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VOTEC Video Downloader</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        /* Fixes any remaining white areas */
        background-color: #030712; 
    }
</style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col items-center justify-center p-4">

<header class="text-center mb-8">
Â  <h1 class="text-4xl font-extrabold text-blue-500">ğŸš€ VOTEC Downloader</h1>
Â  <p class="text-gray-400 text-sm mt-2">Download media from YouTube, Instagram, and more!</p>
</header>

<div class="bg-gray-900 rounded-2xl p-6 w-full max-w-lg shadow-2xl border border-gray-800">
Â  <label for="url" class="block text-sm text-gray-300 mb-2 font-medium">Paste your video link below:</label>
Â  
  <input id="url" type="text" placeholder="https://www.youtube.com/watch?v=..."
Â  Â  Â  Â  Â class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 transition duration-150" />
Â  
  <button id="fetchInfo" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 transition-all py-3 rounded-lg font-semibold shadow-md hover:shadow-lg">
Â  Â  Fetch Video Info
Â  </button>

Â  <div id="videoInfo" class="mt-6 hidden bg-gray-800 p-4 rounded-xl border border-gray-700">
Â  Â  <img id="thumbnail" class="rounded-lg mb-4 w-full object-cover aspect-video" src="" alt="Thumbnail">
Â  Â  <h2 id="title" class="text-xl font-bold mb-4 text-blue-300"></h2>

Â  Â  <label class="text-gray-400 text-sm mb-1 font-semibold">Select Quality & Type:</label>
Â  Â  <div class="relative mb-4">
Â  Â  Â  Â  Â  Â  <select id="formatSelect" class="appearance-none w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
Â  Â  Â  <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">â–¼</div>
Â  Â  </div>

Â  Â  <button id="downloadBtn" class="mt-2 w-full bg-green-600 hover:bg-green-700 transition-all py-3 rounded-lg font-semibold shadow-md hover:shadow-lg">
Â  Â  Â  Download
Â  Â  </button>

Â  Â  Â  Â  <div class="mt-4 bg-gray-700 h-2 rounded-full overflow-hidden hidden" id="progressContainer">
Â  Â  Â  <div id="progressBar" class="bg-blue-500 h-2 w-0 transition-all duration-300"></div>
Â  Â  </div>
Â  </div>

Â  <div id="status" class="mt-4 text-center text-sm text-gray-300 font-medium"></div>
</div>

<footer class="mt-10 text-gray-500 text-xs text-center">
Â  Â© 2025 VOTEC | Built with â¤ï¸ by Kennedy
</footer>

<script>
const fetchBtn = document.getElementById('fetchInfo');
const urlInput = document.getElementById('url');
const videoInfoDiv = document.getElementById('videoInfo');
const thumbnailImg = document.getElementById('thumbnail');
const titleEl = document.getElementById('title');
const formatSelect = document.getElementById('formatSelect');
const statusBox = document.getElementById('status');
const downloadBtn = document.getElementById('downloadBtn');
const progressBar = document.getElementById('progressBar');
const progressContainer = document.getElementById('progressContainer');

fetchBtn.addEventListener('click', async () => {
Â  const url = urlInput.value.trim();
Â  if (!url) { statusBox.textContent = 'âš ï¸ Enter a valid URL.'; return; }
Â  statusBox.textContent = 'â³ Fetching video info...';
Â  formatSelect.innerHTML = '';
  progressContainer.classList.add('hidden'); // Hide progress on new fetch

Â  try {
Â  Â  const res = await fetch('/info', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({ url })
Â  Â  });
Â  Â  const data = await res.json();
Â  Â  
    // Handle error message from backend
Â  Â  if (data.error) { 
        statusBox.textContent = `âŒ ${data.error}. Check URL/Cookies.`; 
        videoInfoDiv.classList.add('hidden');
        return; 
    }

Â  Â  videoInfoDiv.classList.remove('hidden');
Â  Â  thumbnailImg.src = data.thumbnail;
Â  Â  titleEl.textContent = data.title;

Â  Â  data.formats.forEach(f => {
Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  const size = f.filesize ? `(${(f.filesize / 1024 / 1024).toFixed(2)} MB)` : '';
Â  Â  Â  let type = f.vcodec !== 'none' ? 'Video' : 'Audio';
Â  Â  Â  let label = `${type} - ${f.resolution || f.format_note} ${f.ext} ${size}`;
Â  Â  Â  option.value = f.format_id;
Â  Â  Â  option.textContent = label;
Â  Â  Â  formatSelect.appendChild(option);
Â  Â  });

Â  Â  statusBox.textContent = 'âœ… Video info loaded. Choose quality and download.';
Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  statusBox.textContent = 'ğŸš¨ Error fetching video info.';
Â  }
});

downloadBtn.addEventListener('click', async () => {
Â  const url = urlInput.value.trim();
Â  const format_id = formatSelect.value;
Â  // Clean up title for use as a filename
Â  const filename = titleEl.textContent.replace(/[^\w\s\-\.]/gi, "_") || 'video'; 

Â  if (!url || !format_id) return;
Â  statusBox.textContent = 'â³ Starting download stream... This may take a moment.';
Â  progressBar.style.width = '0%'; 
  progressContainer.classList.remove('hidden');

Â  try {
Â  Â  // Send the filename along with the URL and format_id
Â  Â  const res = await fetch('/download', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({ url, format_id, filename }) 
Â  Â  });

Â  Â  if (!res.ok) {
Â  Â  Â  // Attempt to parse the server's error response
Â  Â  Â  const contentType = res.headers.get("content-type");
Â  Â  Â  if (contentType && contentType.indexOf("application/json") !== -1) {
Â  Â  Â  Â  const err = await res.json();
Â  Â  Â  Â  statusBox.textContent = `âŒ ${err.error || 'Download failed'}`;
Â  Â  Â  } else {
Â  Â  Â  Â  statusBox.textContent = `âŒ Download failed with status: ${res.status}`;
Â  Â  Â  }
      progressBar.style.width = '0%';
Â  Â  Â  return;
Â  Â  }
    
    // The browser automatically handles the download prompt due to Content-Disposition header.
    // To trigger the download, we read the response as a blob and simulate the download link.
    // Note: The previous logic relied on the browser downloading the response directly, 
    // but reading as a blob is needed to trigger the browser's save dialog reliably on all OS/browsers.
    
    const blob = await res.blob();
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = filename + ".mp4"; // Ensure file extension is included
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(link.href);

    statusBox.textContent = 'âœ… Download complete! Check your browser downloads.';
Â  Â  progressBar.style.width = '100%';

Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  statusBox.textContent = 'ğŸš¨ Fatal error during download.';
Â  Â  progressBar.style.width = '0%';
Â  }
});
</script>

</body>
</html>